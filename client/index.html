<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Credder.io</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const SUPABASE_URL = "https://ignzvfcfgwowuqebzffq.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlnbnp2ZmNmZ3dvd3VxZWJ6ZmZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NDU3NDksImV4cCI6MjA3ODQyMTc0OX0.wJAllXwUBPijPiWYsyP4oEzq_6Yc-m6WZe6VYKvydxg"; // replace with your anon key
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  window.supabase = supabase;

  // --- Login form dynamically ---
  async function initAuth() {
    const { data: { session } } = await supabase.auth.getSession();
    if (!session) {
      const email = prompt("Enter your email:");
      const password = prompt("Enter a password:");
      let { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        // if not registered, create user
        ({ data, error } = await supabase.auth.signUp({ email, password }));
        if (error) return alert("Signup/Login failed: " + error.message);
      }
      localStorage.setItem("jwt", data.session.access_token);
      await createProfileIfNotExists();
    } else {
      localStorage.setItem("jwt", session.access_token);
      await createProfileIfNotExists();
    }

    // listen for session changes
    supabase.auth.onAuthStateChange((_event, session) => {
      if (session) localStorage.setItem("jwt", session.access_token);
    });
  }

  async function createProfileIfNotExists() {
    const token = localStorage.getItem("jwt");
    const { data: { user } } = await supabase.auth.getUser(token);
    const { data, error } = await supabase
      .from("profiles")
      .select("*")
      .eq("id", user.id)
      .single();

    if (!data) {
      await supabase.from("profiles").insert({ id: user.id, credits: 1000 });
    }
  }

  initAuth();
</script>
</head>
<body>
<div id="menu">
  <h1>Credder.io</h1>
  <select id="stake">
    <option value="100">100 credits</option>
    <option value="500">500 credits</option>
    <option value="1000">1000 credits</option>
  </select>
  <button id="play">Play</button>
</div>

<div id="game-container" style="display:none;"></div>

<script type="module" src="game.js"></script>
</body>
</html>
